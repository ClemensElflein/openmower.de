<style>
    .image-gallery {overflow: auto; margin-left: -1%!important;}
    .image-gallery li {float: left; display: block; margin: 0 0 1% 1%; width: 24%;}
    .image-gallery li a {text-align: center; text-decoration: none!important; color: #777;}
    .image-gallery li a span {display: block; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; padding: 3px 0;}
    .image-gallery li a img {width: 100%; display: block;}
</style>

{{- $dir := .Get "gallery_dir" -}}                 {{/* e.g. "images/vermut-0.13/connect-bottom-wires" */}}
{{- $page := .Page -}}
{{- $pageDir := path.Dir $page.File.Path -}}       {{/* e.g. "docs/robot-assembly/assemble-the-robot/photo-guide" */}}

{{- $fsDir := printf "content/%s/%s/%s" $page.Lang $pageDir $dir | path.Clean -}}

<ul class="image-gallery">
    {{- range (readDir $fsDir) }}
    {{- if not .IsDir }}
    {{- $name := .Name -}}
    {{- $relPath := path.Join $dir $name -}}     {{/* path inside bundle, e.g. "images/.../file.jpg" */}}
    {{- $image := $page.Resources.GetMatch $relPath -}}

    {{- $basename := path.Base $name -}}
    {{- $imagetitle := replace $basename (path.Ext $basename) "" -}}

    {{- with $image }}
    {{- $full  := .Fit  "1600x1600 q99" -}}
    {{- $thumb := .Fill "400x400 q95"  -}}
    <li>
        <a href="{{ $full.Permalink }}" title="{{ $imagetitle }}" class="lightbox-image">
            <img class="nozoom"
                 src="{{ $thumb.Permalink }}"
                 alt="{{ $imagetitle }}"
                 title="{{ $imagetitle }}">
            <span title="{{ $imagetitle }}">{{ $imagetitle }}</span>
        </a>
    </li>
    {{- else }}
    {{- errorf "image-gallery: page %q does not expose %q as a resource. Use a leaf bundle (index.md) so Hugo can publish the images." $page.File.Path $relPath -}}
    {{- end }}

    {{- end }}
    {{- end }}
</ul>
